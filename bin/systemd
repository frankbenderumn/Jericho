#!/bin/bash
git init

# USER="user"
# GROUP="group"
# SERVICE_NAME="jericho"
# DESCRIPTION="Jericho Server System Daemon"

read -p "Enter user:         " USER
read -p "Enter group:        " GROUP
read -p "Enter service:      " SERVICE_NAME
read -p "Enter description:  " DESCRIPTION

ROOTDIR=`git rev-parse --show-toplevel`
EXE_PATH="${ROOTDIR}/bin/launch"
SERVICE_DIR="/etc/systemd/system"
mkdir -p ${SERVICE_DIR}
SERVICE_PATH="${SERVICE_DIR}/${SERVICE_NAME}.service"
touch ${SERVICE_PATH}
echo "${SERVICE_PATH}"

echo -e "[Unit]" > ${SERVICE_PATH}
echo -e "Description=${DESCRIPTION}\\n" >> ${SERVICE_PATH}
echo -e "[Service]" >> ${SERVICE_PATH}
echo -e "ExecStart=${EXE_PATH}" >> ${SERVICE_PATH}
echo -e "Restart=always" >> ${SERVICE_PATH}
echo -e "User=${USER}" >> ${SERVICE_PATH}
echo -e "Group=${GROUP}" >> ${SERVICE_PATH}
echo -e "WorkingDirectory=${ROOTDIR}" >> ${SERVICE_PATH}
echo -e "StandardOutput=journal" >> ${SERVICE_PATH} 
echo -e "StandardError=journal\\n" >> ${SERVICE_PATH} 
echo -e "[Install]" >> ${SERVICE_PATH}
echo -e "WantedBy=default.target" >> ${SERVICE_PATH}

#linux specific
systemctl daemon-reload
systemctl start ${SERVICE_NAME}
systemctl enable ${SERVICE_NAME}
systemctl status ${SERVICE_NAME}

